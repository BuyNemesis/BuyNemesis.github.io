<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patch Notes — Nemesis</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="visit-tracker.js"></script>
  <style>
    :root{--bg:#06060a;--panel:#0b0b0f;--muted:rgba(255,255,255,0.6);--accent:#E8BBF9;--accent-2:#C38EE1}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:linear-gradient(180deg,#040406 0%, var(--bg) 60%);color:#fff;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

    /* NAVBAR copied from index.html so patchnotes gets the same glowing brand */
    .navbar{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(0,0,0,0.9);backdrop-filter:blur(10px);border-bottom:1px solid rgba(232,187,249,0.1);padding:20px 24px;display:flex;align-items:center;justify-content:space-between}
    .nav-container{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:20px;padding:0}
    .nav-brand{font-family:'Outfit', sans-serif;font-size:1.5rem;font-weight:600;color:#E8BBF9;text-shadow:0 0 20px rgba(232,187,249,0.5);text-decoration:none;margin-left:0;padding-left:0}
    .nav-links{display:flex;gap:30px;align-items:center;margin-left:auto;margin-right:0}
    @media (max-width:768px){.navbar{flex-wrap:wrap;padding:12px 20px}.nav-brand{margin-left:0;order:1;width:100%;text-align:left;padding-left:0}.nav-links{margin-left:0;order:2;width:100%;justify-content:flex-start;gap:14px;padding:8px 0 0 0}}
    .nav-btn{color:rgba(255,255,255,0.6);text-decoration:none;font-weight:400;font-size:13px;letter-spacing:0.5px;transition:all 0.3s ease;position:relative;text-transform:uppercase}
    .nav-btn::after{display:none !important}
    .nav-btn:hover{color:#E8BBF9}

    /* Patchnotes content styles (kept from original) */
    .container{max-width:1100px;margin:110px auto 80px;padding:0 20px}
    h1{font-family:Outfit, sans-serif;font-weight:600;font-size:2.4rem;margin-bottom:8px;color:var(--accent)}
    p.lead{color:var(--muted);margin-bottom:18px}
    .notes-list{display:flex;flex-direction:column;gap:14px}
    .note{background:var(--panel);border:1px solid rgba(255,255,255,0.03);border-radius:12px;overflow:hidden}
    .note-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer}
    .note-head .meta{display:flex;gap:12px;align-items:center}
    .note-head .ver{font-family:Outfit, sans-serif;font-weight:600;color:var(--accent)}
    .note-head .date{color:var(--muted);font-size:0.95rem}
    .note-body{padding:0 16px 16px;display:none;color:var(--muted);line-height:1.6}
    .note-body ul{margin:10px 0 0;padding-left:18px}
    .note-body li{margin-bottom:8px}
    .toggle-icon{width:36px;height:36px;border-radius:8px;display:inline-grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#000;font-weight:700}
    .search-row{display:flex;gap:12px;align-items:center;margin:18px 0}
    .search{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
    .empty{padding:28px;text-align:center;color:var(--muted);background:transparent;border-radius:8px}
    footer{max-width:1100px;margin:0 auto 40px;padding:0 20px;color:var(--muted);font-size:0.95rem}
    @media (max-width:720px){h1{font-size:1.7rem}.container{margin:92px auto}}
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="nav-brand">nemesis</a>
    <div class="nav-links">
      <a href="index.html#features" class="nav-btn">Features</a>
      <a href="media.html" class="nav-btn">Media</a>
      <a href="patchnotes.html" class="nav-btn">Patchnotes</a>
      <a href="index.html#screenshots" class="nav-btn">Demos</a>
      <a href="index.html#faq" class="nav-btn">FAQ</a>
      <a href="index.html#buy" class="nav-btn">Buy</a>
    </div>
  </nav>
  <main class="container">
    <header>
      <h1>Patch Notes</h1>
      <p class="lead">Changelog and patch notes for the project. Add entries below to keep users informed.</p>
    </header>
    <section class="search-row">
      <input id="search" class="search" placeholder="Search patch notes (version, text, date)..." />
      <button id="new-note" style="padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));border:none;color:#000;font-weight:700">New</button>
    </section>
    <section class="notes-list" id="notes">
      <!-- notes will be populated from your deployed backend at Render -->
    </section>
    <div id="empty" class="empty" style="display:none">No patch notes found.</div>
  </main>
  <footer>nemesis — changelog</footer>
  <script>
    // Client fetch for patchnotes from the deployed backend.
    // It will try the Render URL and gracefully fallback if unavailable.
    (function(){
      const BACKEND = 'https://nemesis-backend-yv3w.onrender.com/api/patchnotes';
      const notesEl = document.getElementById('notes');
      const search = document.getElementById('search');
      const empty = document.getElementById('empty');

      function escapeHtml(s){
        return (s||'').toString().replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c]);
      }

      function updateEmpty(){
        const any = notesEl.querySelectorAll('.note');
        empty.style.display = any.length ? 'none' : '';
      }

      function wireToggle(article){
        const head = article.querySelector('.note-head');
        const body = article.querySelector('.note-body');
        const icon = article.querySelector('.toggle-icon');
        head.addEventListener('click', ()=>{
          const open = body.style.display === 'block';
          if(open){ body.style.display = 'none'; icon.textContent = '+'; }
          else{ body.style.display = 'block'; icon.textContent = '−'; }
        });
      }

      function renderParsedNote(n){
        const article = document.createElement('article');
        article.className = 'note';
        article.setAttribute('data-version', n.version||'');
        article.setAttribute('data-date', n.date||'');
        const detailsHtml = (n.details||[]).map(d=>`<li>${escapeHtml(d)}</li>`).join('');
        article.innerHTML = `\n          <div class="note-head">\n            <div class="meta">\n              <div class="ver">${escapeHtml(n.version||'')}</div>\n              <div class="date">${escapeHtml(n.date||'')}</div>\n            </div>\n            <div class="toggle-icon">+</div>\n          </div>\n          <div class="note-body">\n            <p>${escapeHtml(n.title||'')}</p>\n            ${ detailsHtml ? `<ul>${detailsHtml}</ul>` : '' }\n          </div>\n        `;
        wireToggle(article);
        return article;
      }

      // parse raw message text in the format described
      function parseRawMessage(text){
        const lines = text.replace(/\r/g,'').split('\n').map(l=>l.trim()).filter(Boolean);
        if(lines.length < 3) return null;
        const date = lines[0];
        const version = lines[1];
        const title = lines[2];
        const details = lines.slice(3).map(l=>l.replace(/^[-*\u2022]\s?/, '').trim()).filter(Boolean);
        return { date, version, title, details };
      }

      async function load(){
        try{
          const resp = await fetch(BACKEND, { cache: 'no-store' });
          if(!resp.ok) throw new Error('Network error');
          const data = await resp.json();

          notesEl.innerHTML = '';

          // If backend returned parsed notes (notes array), use it
          if(Array.isArray(data.notes)){
            data.notes.forEach(n=> notesEl.appendChild(renderParsedNote(n)));
            updateEmpty();
            return;
          }

          // Otherwise, try to interpret data as array of messages or a single text blob
          if(Array.isArray(data)){
            data.forEach(item=>{
              // item could be an object {content: '...'} or a string
              const raw = typeof item === 'string' ? item : (item.content||'');
              const parsed = parseRawMessage(raw);
              if(parsed) notesEl.appendChild(renderParsedNote({ date: parsed.date, version: parsed.version, title: parsed.title, details: parsed.details }));
            });
            updateEmpty();
            return;
          }

          // fallback: if data.message or data.content exists, try parseRawMessage
          const raw = data.message || data.content || '';
          const parsed = parseRawMessage(raw);
          if(parsed){ notesEl.appendChild(renderParsedNote(parsed)); updateEmpty(); return; }

          // nothing usable
          updateEmpty();
        }catch(err){
          console.warn('Patchnotes: failed to load from backend', err);
          // leave notes empty and show fallback message
          updateEmpty();
        }
      }

      // wire search/local new button behavior (works even when notes are dynamic)
      search.addEventListener('input', ()=>{
        const q = search.value.trim().toLowerCase();
        const notes = Array.from(notesEl.querySelectorAll('.note'));
        let shown = 0;
        notes.forEach(note=>{
          const v = note.getAttribute('data-version')||'';
          const d = note.getAttribute('data-date')||'';
          const txt = (note.textContent||'').toLowerCase();
          const match = !q || v.includes(q) || d.includes(q) || txt.includes(q);
          note.style.display = match ? '' : 'none';
          if(match) shown++;
        });
        empty.style.display = shown ? 'none' : '';
      });

      document.getElementById('new-note').addEventListener('click', ()=>{
        const ver = prompt('Version (e.g. v1.2.0)');
        if(!ver) return;
        const date = prompt('Date (e.g. 10/10/2025)', new Date().toLocaleDateString());
        const body = prompt('Short notes (HTML allowed)');
        const article = document.createElement('article');
        article.className = 'note';
        article.setAttribute('data-version', ver);
        article.setAttribute('data-date', date);
        article.innerHTML = `\n          <div class="note-head">\n            <div class="meta">\n              <div class="ver">${ver}</div>\n              <div class="date">${date}</div>\n            </div>\n            <div class="toggle-icon">−</div>\n          </div>\n          <div class="note-body" style="display:block">${escapeHtml(body||'')}</div>\n        `;
        notesEl.insertAdjacentElement('afterbegin', article);
        const head = article.querySelector('.note-head');
        const bodyEl = article.querySelector('.note-body');
        head.addEventListener('click', ()=>{ const open = bodyEl.style.display === 'block'; if(open){ bodyEl.style.display = 'none'; } else{ bodyEl.style.display = 'block'; } });
        updateEmpty();
      });

      // initial load
      load();
    })();
  </script>
  
  
</body>
</html>