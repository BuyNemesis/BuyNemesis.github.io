<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night External - Premium Access</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <a href="#features" class="nav-btn">Features</a>
        <a href="#screenshots" class="nav-btn">Screenshots</a>
        <a href="#faq" class="nav-btn">FAQ</a>
        <a href="#buy" class="nav-btn">Buy</a>
    </nav>

    <section class="hero">
        <div>
            <h1 class="hero-title">night</h1>
            <p class="hero-subtitle">Why settle for less?</p>
            <div style="margin-top:40px;">
                <a href="https://discord.gg/YjRddSNq2y" class="purchase-btn" style="width:auto;display:inline-block;">Buy Now</a>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews" id="reviews">
        <div class="container">
            <h2>What Our Users Say</h2>
            <p>Real reviews from our Discord community</p>
            <div class="reviews-grid" id="reviews-grid">
                <div class="review-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading reviews...</p>
                </div>
            </div>
        </div>
    </section>

    <script>
    // Reviews System
    let allReviews = [];
    let isShowingAll = false;
    const REVIEWS_TO_SHOW = 6;

    function timeAgo(dateString) {
        if (!dateString) return '';
        const now = new Date();
        const then = new Date(dateString);
        const seconds = Math.floor((now - then) / 1000);
        
        if (isNaN(seconds)) return '';
        if (seconds < 60) return 'Just now';
        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
        if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
        if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
        if (seconds < 2419200) return `${Math.floor(seconds / 604800)}w ago`;
        if (seconds < 29030400) return `${Math.floor(seconds / 2419200)}mo ago`;
        return `${Math.floor(seconds / 29030400)}y ago`;
    }

    function createReviewCard(review) {
        const username = review.author?.username || 'Anonymous';
        const initials = username.substring(0, 2).toUpperCase();
        const rating = typeof review.rating === 'number' ? review.rating : 5;
        const stars = '★'.repeat(Math.max(0, rating)) + '☆'.repeat(Math.max(0, 5 - rating));
        const ago = timeAgo(review.timestamp);
        const avatar = review.author?.avatar 
            ? `<img src="${review.author.avatar}" alt="${username}" class="avatar-img">` 
            : `<div class="avatar-initials">${initials}</div>`;
        
        return `
            <div class="review-card" data-rating="${rating}">
                <div class="review-header">
                    <div class="review-avatar">${avatar}</div>
                    <div class="review-info">
                        <h4>${username}</h4>
                        <div class="review-date">${ago}</div>
                    </div>
                </div>
                <div class="review-content">${review.content || 'No review message.'}</div>
                <div class="review-rating">
                    <span class="stars">${stars}</span>
                    <span class="rating-text">${rating}/5</span>
                </div>
            </div>
        `;
    }

    function updateReviewDisplay() {
        const grid = document.getElementById('reviews-grid');
        if (!grid) return;

        const reviewsToDisplay = isShowingAll ? allReviews : allReviews.slice(0, REVIEWS_TO_SHOW);
        
        const reviewCards = reviewsToDisplay.map(createReviewCard).join('');
        
        let html = reviewCards;

        // Add View More/Less button if needed
        if (allReviews.length > REVIEWS_TO_SHOW) {
            html += `
                <div class="view-more-container">
                    <button class="view-more-btn" onclick="toggleViewMore()">
                        ${isShowingAll 
                            ? 'Show Less' 
                            : `View More (${allReviews.length - REVIEWS_TO_SHOW} more)`}
                    </button>
                </div>
            `;
        }

        grid.innerHTML = html;
    }

    function toggleViewMore() {
        isShowingAll = !isShowingAll;
        updateReviewDisplay();
    }

    async function updateReviews() {
        const grid = document.getElementById('reviews-grid');
        if (!grid) return;

        try {
            const response = await fetch('https://nemesis-backend-yv3w.onrender.com/api/reviews');
            if (!response.ok) throw new Error('Failed to fetch reviews');
            
            const data = await response.json();
            if (!Array.isArray(data.reviews)) throw new Error('Invalid reviews data');
            
            allReviews = data.reviews;
            
            if (allReviews.length === 0) {
                grid.innerHTML = '<div class="review-card"><div class="review-content">No reviews yet.</div></div>';
                return;
            }

            updateReviewDisplay();

        } catch (error) {
            console.error('Error fetching reviews:', error);
            grid.innerHTML = `
                <div class="review-card">
                    <div class="review-content">
                        Failed to load reviews. Please try again later.
                        <br><br>
                        Error: ${error.message}
                    </div>
                </div>
            `;
        }
    }

    // Initialize reviews and set up auto-refresh
    document.addEventListener('DOMContentLoaded', () => {
        updateReviews();
        setInterval(updateReviews, 60000);  // Refresh every minute
    });
    </script>
</body>
</html>